<script>
    const chatWindow = document.getElementById('chat-window');
    const API_KEY = "AIzaSyBX6NGNI_jcj6az8Zay-N-VgTyrvevEJkY"; 

    async function sendMessage() {
        const input = document.getElementById('user-input');
        const text = input.value.trim();
        if (!text) return;
        addMessage(text, 'user');
        input.value = "";

        try {
            // التعديل النهائي: استخدام v1 الصريحة مع gemini-1.5-flash
            const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ contents: [{ parts: [{ text: text }] }] })
            });
            
            const data = await response.json();
            
            if (data.candidates && data.candidates[0].content) {
                addMessage(data.candidates[0].content.parts[0].text, 'ai');
            } else {
                addMessage("الرد جاهز، بس جربي تعملي Refresh للصفحة.", "ai");
            }
        } catch (e) {
            addMessage("فيه مشكلة بسيطة، جربي تاني.", "ai");
        }
    }
    window.onload = () => addMessage("Retag AI is ready! Type something.", "ai");
</script>
